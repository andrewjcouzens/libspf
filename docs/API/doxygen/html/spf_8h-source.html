<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libSPF v1.0: spf.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>spf.h</h1><a href="spf_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/* libspf - Sender Policy Framework library</span>
00002 <span class="comment">*</span>
00003 <span class="comment">*  ANSI C implementation of spf-draft-200405.txt</span>
00004 <span class="comment">*</span>
00005 <span class="comment">*  Author: James Couzens &lt;jcouzens@codeshare.ca&gt;</span>
00006 <span class="comment">*  Author: Sean Comeau   &lt;scomeau@obscurity.org&gt;</span>
00007 <span class="comment">*</span>
00008 <span class="comment">*  FILE: spf.h</span>
00009 <span class="comment">*  DESC: main library header file</span>
00010 <span class="comment">*</span>
00011 <span class="comment">*  License:</span>
00012 <span class="comment">*</span>
00013 <span class="comment">*  The libspf Software License, Version 1.0</span>
00014 <span class="comment">*</span>
00015 <span class="comment">*  Copyright (c) 2004 James Couzens &amp; Sean Comeau  All rights</span>
00016 <span class="comment">*  reserved.</span>
00017 <span class="comment">*</span>
00018 <span class="comment">*  Redistribution and use in source and binary forms, with or without</span>
00019 <span class="comment">*  modification, are permitted provided that the following conditions</span>
00020 <span class="comment">*  are met:</span>
00021 <span class="comment">*</span>
00022 <span class="comment">*  1. Redistributions of source code must retain the above copyright</span>
00023 <span class="comment">*     notice, this list of conditions and the following disclaimer.</span>
00024 <span class="comment">*</span>
00025 <span class="comment">*  2. Redistributions in binary form must reproduce the above copyright</span>
00026 <span class="comment">*     notice, this list of conditions and the following disclaimer in</span>
00027 <span class="comment">*     the documentation and/or other materials provided with the</span>
00028 <span class="comment">*     distribution.</span>
00029 <span class="comment">*</span>
00030 <span class="comment">*  THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</span>
00031 <span class="comment">*  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span>
00032 <span class="comment">*  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
00033 <span class="comment">*  DISCLAIMED.  IN NO EVENT SHALL THE AUTHORS MAKING USE OF THIS LICESEN</span>
00034 <span class="comment">*  OR ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
00035 <span class="comment">*  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
00036 <span class="comment">*  LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</span>
00037 <span class="comment">*  USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
00038 <span class="comment">*  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
00039 <span class="comment">*  OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</span>
00040 <span class="comment">*  OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
00041 <span class="comment">*  SUCH DAMAGE.</span>
00042 <span class="comment">*</span>
00043 <span class="comment">*/</span>
00044 
00045 
00046 <span class="preprocessor">#ifndef _SPF_H</span>
<a name="l00047"></a><a class="code" href="spf_8h.html#a0">00047</a> <span class="preprocessor"></span><span class="preprocessor">#define _SPF_H 1</span>
00048 <span class="preprocessor"></span>
00049 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>    <span class="comment">/* typedefs */</span>
00050 <span class="preprocessor">#include &lt;netinet/in.h&gt;</span>   <span class="comment">/* in_addr struct fBSD */</span>
00051 <span class="preprocessor">#include &lt;arpa/inet.h&gt;</span>    <span class="comment">/* in_addr struct */</span>
00052 
00053 __BEGIN_DECLS
00054 
00055 
00056 <span class="comment">/* spf protocol version we support */</span>
<a name="l00057"></a><a class="code" href="spf_8h.html#a1">00057</a> <span class="preprocessor">#define SPF_VERSION 1</span>
00058 <span class="preprocessor"></span>
00059 <span class="comment">/*</span>
00060 <span class="comment">*  For reference purposes commented out are the constants based on</span>
00061 <span class="comment">*  RFC 883, RFC 1034, RFC 1035.</span>
00062 <span class="comment">*</span>
00063 <span class="comment">*  #define PACKETSZ  512   max response packet size</span>
00064 <span class="comment">*  #define MAXDNAME  1025  max uncompressed IN_TXT record</span>
00065 <span class="comment">*  #define MAXCDNAME 255   max compressed IN_TXT record</span>
00066 <span class="comment">*</span>
00067 <span class="comment">*/</span>
00068 
<a name="l00069"></a><a class="code" href="spf_8h.html#a2">00069</a> <span class="preprocessor">#define SPF_MAX_CNAME      5     </span><span class="comment">/* we follow up max CNAMEs */</span>
<a name="l00070"></a><a class="code" href="spf_8h.html#a3">00070</a> <span class="preprocessor">#define SPF_MAX_DEBUG      2048  </span><span class="comment">/* maximum for debug code to malloc */</span>
<a name="l00071"></a><a class="code" href="spf_8h.html#a4">00071</a> <span class="preprocessor">#define SPF_MAX_MACRO      1024  </span><span class="comment">/* max length of an expanded macro */</span>
<a name="l00072"></a><a class="code" href="spf_8h.html#a5">00072</a> <span class="preprocessor">#define SPF_MAX_STR        4096  </span><span class="comment">/* max length of any dynamically allocated string */</span>
<a name="l00073"></a><a class="code" href="spf_8h.html#a6">00073</a> <span class="preprocessor">#define SPF_MAX_DELIM      255   </span><span class="comment">/* used by UTIL_count_delim() */</span>
00074 
<a name="l00075"></a><a class="code" href="spf_8h.html#a7">00075</a> <span class="preprocessor">#define SPF_MAX_LOCAL_PART 256   </span><span class="comment">/* local-part, text before @ in email addy */</span>
<a name="l00076"></a><a class="code" href="spf_8h.html#a8">00076</a> <span class="preprocessor">#define SPF_MAX_ENV_SENDER 512   </span><span class="comment">/* entire FROM: string passed by MTA */</span>
<a name="l00077"></a><a class="code" href="spf_8h.html#a9">00077</a> <span class="preprocessor">#define SPF_MAX_CUR_DOM    256   </span><span class="comment">/* text after @ in email addy for cur query */</span>
<a name="l00078"></a><a class="code" href="spf_8h.html#a10">00078</a> <span class="preprocessor">#define SPF_MAX_UTC_TIME   22    </span><span class="comment">/* time since epoch */</span>
<a name="l00079"></a><a class="code" href="spf_8h.html#a11">00079</a> <span class="preprocessor">#define SPF_MAX_IP_ADDR    17    </span><span class="comment">/* ip of remote peer - DON'T CHANGE FROM 17!! */</span>
<a name="l00080"></a><a class="code" href="spf_8h.html#a12">00080</a> <span class="preprocessor">#define SPF_MAX_IP_VER     8     </span><span class="comment">/* ip protocol version */</span>
<a name="l00081"></a><a class="code" href="spf_8h.html#a13">00081</a> <span class="preprocessor">#define SPF_MAX_ENV_HELO   512   </span><span class="comment">/* entire HELO string passed by MTA */</span>
00082 
<a name="l00083"></a><a class="code" href="spf_8h.html#a14">00083</a> <span class="preprocessor">#define SPF_MAX_HNAME      256   </span><span class="comment">/* hostname of MTA */</span>
<a name="l00084"></a><a class="code" href="spf_8h.html#a15">00084</a> <span class="preprocessor">#define SPF_MAX_RESULT      64   </span><span class="comment">/* human readable SPF result */</span>
<a name="l00085"></a><a class="code" href="spf_8h.html#a16">00085</a> <span class="preprocessor">#define SPF_MAX_ERROR       96   </span><span class="comment">/* human readable error reason */</span>
<a name="l00086"></a><a class="code" href="spf_8h.html#a17">00086</a> <span class="preprocessor">#define SPF_MAX_EXPLAIN_S  256   </span><span class="comment">/* change to EXPLAIN when cleaning up */</span>
<a name="l00087"></a><a class="code" href="spf_8h.html#a18">00087</a> <span class="preprocessor">#define SPF_MAX_ENV_RECV   512   </span><span class="comment">/* maximum length of RFC2821 header string */</span>
<a name="l00088"></a><a class="code" href="spf_8h.html#a19">00088</a> <span class="preprocessor">#define SPF_MAX_RES_STR     12   </span><span class="comment">/* maximum legnth of a res str eg: "pass" */</span>
00089 
<a name="l00090"></a><a class="code" href="spf_8h.html#a20">00090</a> <span class="preprocessor">#define SPF_MAX_MECHANISM  256   </span><span class="comment">/* maximum length of a mechanism */</span>
<a name="l00091"></a><a class="code" href="spf_8h.html#a21">00091</a> <span class="preprocessor">#define SPF_MAX_HEADER     512   </span><span class="comment">/* maximum length of header for prepend */</span>
<a name="l00092"></a><a class="code" href="spf_8h.html#a22">00092</a> <span class="preprocessor">#define SPF_MAX_SMTP_RES   256   </span><span class="comment">/* maximum length of smtp resonse string */</span>
00093 
00094 <span class="comment">/* human readable string equivalents of spf responses */</span>
<a name="l00095"></a><a class="code" href="spf_8h.html#a23">00095</a> <span class="preprocessor">#define HR_RFC2822  "Received-SPF: "</span>
<a name="l00096"></a><a class="code" href="spf_8h.html#a24">00096</a> <span class="preprocessor"></span><span class="preprocessor">#define HR_PASS     "pass"</span>
<a name="l00097"></a><a class="code" href="spf_8h.html#a25">00097</a> <span class="preprocessor"></span><span class="preprocessor">#define HR_NONE     "none"</span>
<a name="l00098"></a><a class="code" href="spf_8h.html#a26">00098</a> <span class="preprocessor"></span><span class="preprocessor">#define HR_S_FAIL   "softfail"</span>
<a name="l00099"></a><a class="code" href="spf_8h.html#a27">00099</a> <span class="preprocessor"></span><span class="preprocessor">#define HR_H_FAIL   "fail"</span>
<a name="l00100"></a><a class="code" href="spf_8h.html#a28">00100</a> <span class="preprocessor"></span><span class="preprocessor">#define HR_ERROR    "error"</span>
<a name="l00101"></a><a class="code" href="spf_8h.html#a29">00101</a> <span class="preprocessor"></span><span class="preprocessor">#define HR_NEUTRAL  "neutral"</span>
<a name="l00102"></a><a class="code" href="spf_8h.html#a30">00102</a> <span class="preprocessor"></span><span class="preprocessor">#define HR_UNKNOWN  "unknown"</span>
<a name="l00103"></a><a class="code" href="spf_8h.html#a31">00103</a> <span class="preprocessor"></span><span class="preprocessor">#define HR_UNMECH   "unknown mechanism"</span>
00104 <span class="preprocessor"></span>
00105 <span class="comment">/* default explanation */</span>
<a name="l00106"></a><a class="code" href="spf_8h.html#a32">00106</a> <span class="preprocessor">#define SPF_EXPLAIN "See http://spf.pobox.com/why.html?sender=%{S}&amp;"      \</span>
00107 <span class="preprocessor">                    "ip=%{I}&amp;receiver=%{xR}"</span>
00108 <span class="preprocessor"></span>
00109 <span class="comment">/* default best guess */</span>
<a name="l00110"></a><a class="code" href="spf_8h.html#a33">00110</a> <span class="preprocessor">#define SPF_GUESS   "v=spf1 a/24 mx/24 ptr "</span>
00111 <span class="preprocessor"></span>
00112 <span class="comment">/* trusted forwarder */</span>
<a name="l00113"></a><a class="code" href="spf_8h.html#a34">00113</a> <span class="preprocessor">#define SPF_TRUSTED "v=spf1 include:spf.trusted-forwarder.org "</span>
00114 <span class="preprocessor"></span>
00115 
00116 <span class="comment">/* SPF_BOOL</span>
00117 <span class="comment">*</span>
00118 <span class="comment">*  Our own internal boolean enumeration, simple true or false.</span>
00119 <span class="comment">*</span>
00120 <span class="comment">*  Sendmail has issues because it makes use of SPF_FALSE and SPF_TRUE</span>
00121 <span class="comment">*  Simple way around it iis to simply check and see if they are</span>
00122 <span class="comment">*  defined or not since we're declaring this enumeration</span>
00123 <span class="comment">*  globally.</span>
00124 <span class="comment">*</span>
00125 <span class="comment">*  A more graceful fix has been implemented in libspf 3.0 where</span>
00126 <span class="comment">*  we now make use of SPF_SPF_TRUE and SPF_SPF_FALSE to steer clear of</span>
00127 <span class="comment">*  problems such as this elsewhere.</span>
00128 <span class="comment">*</span>
00129 <span class="comment">*/</span>
00130 
<a name="l00131"></a><a class="code" href="spf_8h.html#a87">00131</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="spf_8h.html#a35">SPF_BOOL</a>
00132 {
00133   <a class="code" href="spf_8h.html#a87a49">SPF_FALSE</a> = 0,
00134   <a class="code" href="spf_8h.html#a87a50">SPF_TRUE</a>
00135 } <a class="code" href="spf_8h.html#a35">SPF_BOOL</a>;
00136 
00137 
00138 <span class="comment">/* SPF_RESULT</span>
00139 <span class="comment">*</span>
00140 <span class="comment">*  Error codes representing the result of an SPF policy examination</span>
00141 <span class="comment">*</span>
00142 <span class="comment">*  sucessful parse (some match was made) (+all)</span>
00143 <span class="comment">*  not participating (no SPF/TXT records)</span>
00144 <span class="comment">*  ~all</span>
00145 <span class="comment">*  failed parse (no match made) (-all)</span>
00146 <span class="comment">*  dns problem / error</span>
00147 <span class="comment">*  ?all</span>
00148 <span class="comment">*  permanent parsing error during record examination</span>
00149 <span class="comment">*</span>
00150 <span class="comment">*/</span>
<a name="l00151"></a><a class="code" href="spf_8h.html#a88">00151</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="spf_8h.html#a36">SPF_RESULT</a>
00152 {
00153   <a class="code" href="spf_8h.html#a88a51">SPF_PASS</a> = 0,     <span class="comment">/* + */</span>
00154   <a class="code" href="spf_8h.html#a88a52">SPF_NONE</a>,
00155   <a class="code" href="spf_8h.html#a88a53">SPF_S_FAIL</a>,       <span class="comment">/* ~ */</span>
00156   <a class="code" href="spf_8h.html#a88a54">SPF_H_FAIL</a>,       <span class="comment">/* - */</span>
00157   <a class="code" href="spf_8h.html#a88a55">SPF_ERROR</a>,
00158   <a class="code" href="spf_8h.html#a88a56">SPF_NEUTRAL</a>,      <span class="comment">/* ? */</span>
00159   <a class="code" href="spf_8h.html#a88a57">SPF_UNKNOWN</a>,
00160   <a class="code" href="spf_8h.html#a88a58">SPF_UNMECH</a>        <span class="comment">/* unknown mechanism */</span>
00161 } <a class="code" href="spf_8h.html#a36">SPF_RESULT</a>;
00162 
00163 
00164 <span class="comment">/* SPF_ACTION</span>
00165 <span class="comment">*</span>
00166 <span class="comment">*  Error codes representing the the action to be taken as a result</span>
00167 <span class="comment">*  of the response the library was able to obtain whilst trying to</span>
00168 <span class="comment">*  obtain or examin an SPF policy</span>
00169 <span class="comment">*</span>
00170 <span class="comment">*/</span>
<a name="l00171"></a><a class="code" href="spf_8h.html#a89">00171</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="spf_8h.html#a37">SPF_ACTION</a>
00172 {
00173   <a class="code" href="spf_8h.html#a89a59">DEFER</a> = 0,
00174   <a class="code" href="spf_8h.html#a89a60">TARPIT</a>,
00175   <a class="code" href="spf_8h.html#a89a61">ALLOW</a>,
00176   <a class="code" href="spf_8h.html#a89a62">REJECT</a>
00177 } <a class="code" href="spf_8h.html#a37">SPF_ACTION</a>;
00178 
00179 
00180 <span class="comment">/* SPF_MECHANISM</span>
00181 <span class="comment">*</span>
00182 <span class="comment">*  Error codes representing the various mechanism types employed</span>
00183 <span class="comment">*  as defined in the RFC</span>
00184 <span class="comment">*</span>
00185 <span class="comment">*/</span>
00186 <span class="preprocessor">#undef VERSION </span><span class="comment">/* autoconf */</span>
<a name="l00187"></a><a class="code" href="spf_8h.html#a90">00187</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="spf_8h.html#a38">SPF_MECHANISM</a>
00188 {
00189   <a class="code" href="spf_8h.html#a90a63">NO_POLICY</a> = 0,
00190   <a class="code" href="spf_8h.html#a90a64">VERSION</a>,
00191   <a class="code" href="spf_8h.html#a90a65">ALL</a>,
00192   <a class="code" href="spf_8h.html#a90a66">INCLUDE</a>,
00193   <a class="code" href="spf_8h.html#a90a67">A</a>,
00194   <a class="code" href="spf_8h.html#a90a68">MX</a>,
00195   <a class="code" href="spf_8h.html#a90a69">PTR</a>,
00196   <a class="code" href="spf_8h.html#a90a70">IP4</a>,
00197   <a class="code" href="spf_8h.html#a90a71">IP6</a>,
00198   <a class="code" href="spf_8h.html#a90a72">EXISTS</a>,
00199   <a class="code" href="spf_8h.html#a90a73">REDIRECT</a>,
00200   <a class="code" href="spf_8h.html#a90a74">EXPLAIN</a>,
00201   <a class="code" href="spf_8h.html#a90a75">DEFAULT</a>, <span class="comment">/* this is OLD school for early adopters = ~,?,+,- */</span>
00202   <a class="code" href="spf_8h.html#a90a76">UNMECH</a>
00203 } <a class="code" href="spf_8h.html#a38">SPF_MECHANISM</a>;
00204 
00205 
00206 <span class="comment">/* spf_result_t</span>
00207 <span class="comment">*</span>
00208 <span class="comment">*  Storage container used to store the result of an SPF parse.</span>
00209 <span class="comment">*</span>
00210 <span class="comment">*/</span>
<a name="l00211"></a><a class="code" href="structspf__result__t.html">00211</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structspf__result__t.html">spf_result_t</a>
00212 {
<a name="l00213"></a><a class="code" href="structspf__result__t.html#o0">00213</a>   size_t <a class="code" href="structspf__result__t.html#o0">sl</a>;      <span class="comment">/* spf result string length */</span>
<a name="l00214"></a><a class="code" href="structspf__result__t.html#o1">00214</a>   <span class="keywordtype">char</span> <a class="code" href="structspf__result__t.html#o1">s</a>[32];     <span class="comment">/* spf result type string */</span>
<a name="l00215"></a><a class="code" href="structspf__result__t.html#o2">00215</a>   <a class="code" href="spf_8h.html#a36">SPF_RESULT</a> <a class="code" href="structspf__result__t.html#o2">i</a>;   <span class="comment">/* spf result type */</span>
<a name="l00216"></a><a class="code" href="structspf__result__t.html#o3">00216</a>   size_t <a class="code" href="structspf__result__t.html#o3">hl</a>;      <span class="comment">/* length of header string */</span>
<a name="l00217"></a><a class="code" href="structspf__result__t.html#o4">00217</a>   <span class="keywordtype">char</span> <a class="code" href="structspf__result__t.html#o4">h</a>[512];    <span class="comment">/* Received-SPF: header string */</span>
<a name="l00218"></a><a class="code" href="structspf__result__t.html#o5">00218</a>   <span class="keywordtype">char</span> <a class="code" href="structspf__result__t.html#o5">p</a>;         <span class="comment">/* prefix identifier */</span>
00219 } <a class="code" href="structspf__result__t.html">spf_result_t</a>;
00220 
00221 
00222 <span class="comment">/* policy_addr_t</span>
00223 <span class="comment">*</span>
00224 <span class="comment">*  Storage container used to store parsed out ip addresses in their</span>
00225 <span class="comment">*  binary format (in_addr struct) and an unsigned integer containing</span>
00226 <span class="comment">*  the netmask</span>
00227 <span class="comment">*</span>
00228 <span class="comment">*/</span>
<a name="l00229"></a><a class="code" href="structpolicy__addr__s.html">00229</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structpolicy__addr__s.html">policy_addr_s</a>
00230 {
<a name="l00231"></a><a class="code" href="structpolicy__addr__s.html#o0">00231</a>   <a class="code" href="spf_8h.html#a36">SPF_RESULT</a> <a class="code" href="structpolicy__addr__s.html#o0">prefix</a>;      <span class="comment">/* spf prefix (-,+,~,?) */</span>
<a name="l00232"></a><a class="code" href="structpolicy__addr__s.html#o1">00232</a>   int8_t <a class="code" href="structpolicy__addr__s.html#o1">cidr</a>;            <span class="comment">/* address cidr length */</span>
<a name="l00233"></a><a class="code" href="structpolicy__addr__s.html#o2">00233</a>   <span class="keyword">struct </span>in_addr addr;    <span class="comment">/* in_addr struct (unsigned long) */</span>
00234 } <a class="code" href="structpolicy__addr__s.html">policy_addr_t</a>;
00235 
00236 
00237 <span class="comment">/* spf_config_t</span>
00238 <span class="comment">*</span>
00239 <span class="comment">* Global config structure</span>
00240 <span class="comment">*</span>
00241 <span class="comment">*/</span>
<a name="l00242"></a><a class="code" href="structspf__config__s.html">00242</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structspf__config__s.html">spf_config_s</a>
00243 {
<a name="l00244"></a><a class="code" href="structspf__config__s.html#o0">00244</a>   <span class="keywordtype">int</span> <a class="code" href="structspf__config__s.html#o0">level</a>;    <span class="comment">/* debug level bit */</span>
00245 } <a class="code" href="structspf__config__s.html">spf_config_t</a>;
00246 
00247 
00248 <span class="comment">/* split_str_node_t</span>
00249 <span class="comment">*</span>
00250 <span class="comment">*  This structure is used to store where the head and tail are when</span>
00251 <span class="comment">*  creating a list of split_str_node_t structures.</span>
00252 <span class="comment">*</span>
00253 <span class="comment">*/</span>
<a name="l00254"></a><a class="code" href="structstrbuf__node__s.html">00254</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structstrbuf__node__s.html">strbuf_node_s</a>
00255 {
<a name="l00256"></a><a class="code" href="structstrbuf__node__s.html#o0">00256</a>   size_t                 <a class="code" href="structstrbuf__node__s.html#o0">len</a>;    <span class="comment">/* length of string */</span>
<a name="l00257"></a><a class="code" href="structstrbuf__node__s.html#o1">00257</a>   <span class="keywordtype">char</span>                   *<a class="code" href="structstrbuf__node__s.html#o1">s</a>;     <span class="comment">/* expanded string macro */</span>
<a name="l00258"></a><a class="code" href="structstrbuf__node__s.html#o2">00258</a>   <span class="keyword">struct </span><a class="code" href="structstrbuf__node__s.html">strbuf_node_s</a>   *<a class="code" href="structstrbuf__node__s.html#o2">next</a>;  <span class="comment">/* pointer to next node */</span>
00259 } <a class="code" href="structstrbuf__node__s.html">strbuf_node_t</a>;
00260 
00261 
00262 <span class="comment">/* strbuf_t</span>
00263 <span class="comment">*</span>
00264 <span class="comment">*  This structure is used exclusively by marco.c functions and is used</span>
00265 <span class="comment">*  to store macros during parsing.</span>
00266 <span class="comment">*</span>
00267 <span class="comment">*/</span>
<a name="l00268"></a><a class="code" href="structstrbuf__s.html">00268</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structstrbuf__s.html">strbuf_s</a>
00269 {
<a name="l00270"></a><a class="code" href="structstrbuf__s.html#o0">00270</a>   <a class="code" href="structstrbuf__node__s.html">strbuf_node_t</a>   *<a class="code" href="structstrbuf__s.html#o0">head</a>;      <span class="comment">/* head node */</span>
<a name="l00271"></a><a class="code" href="structstrbuf__s.html#o1">00271</a>   u_int8_t        <a class="code" href="structstrbuf__s.html#o1">elements</a>;   <span class="comment">/* number of nodes in list */</span>
00272 } <a class="code" href="structstrbuf__s.html">strbuf_t</a>;
00273 
00274 
00275 <span class="comment">/* split_str_node_t</span>
00276 <span class="comment">*</span>
00277 <span class="comment">*  This structure is used to store where the head and tail are when</span>
00278 <span class="comment">*  creating a list of split_str_node_t structures.</span>
00279 <span class="comment">*</span>
00280 <span class="comment">*/</span>
<a name="l00281"></a><a class="code" href="structsplit__str__node__s.html">00281</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structsplit__str__node__s.html">split_str_node_s</a>
00282 {
<a name="l00283"></a><a class="code" href="structsplit__str__node__s.html#o0">00283</a>   size_t                   <a class="code" href="structsplit__str__node__s.html#o0">len</a>;    <span class="comment">/* length of string */</span>
<a name="l00284"></a><a class="code" href="structsplit__str__node__s.html#o1">00284</a>   <span class="keywordtype">char</span>                     *<a class="code" href="structsplit__str__node__s.html#o1">s</a>;     <span class="comment">/* expanded string macro */</span>
<a name="l00285"></a><a class="code" href="structsplit__str__node__s.html#o2">00285</a>   <span class="keyword">struct </span><a class="code" href="structsplit__str__node__s.html">split_str_node_s</a>  *<a class="code" href="structsplit__str__node__s.html#o2">next</a>;  <span class="comment">/* pointer to next node */</span>
00286 } <a class="code" href="structsplit__str__node__s.html">split_str_node_t</a>;
00287 
00288 
00289 <span class="comment">/* split_str_t</span>
00290 <span class="comment">*</span>
00291 <span class="comment">*  This structure is used exclusively by the UTIL_reverse function and is</span>
00292 <span class="comment">*  used to reverse a string using a semi-arbitrary delimiter (see</span>
00293 <span class="comment">*  UTIL_is_spf_delim for valid delimiters, or the SPF RFC)</span>
00294 <span class="comment">*/</span>
<a name="l00295"></a><a class="code" href="structsplit__str__s.html">00295</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structsplit__str__s.html">split_str_s</a>
00296 {
<a name="l00297"></a><a class="code" href="structsplit__str__s.html#o0">00297</a>   <a class="code" href="structsplit__str__node__s.html">split_str_node_t</a>  *<a class="code" href="structsplit__str__s.html#o0">head</a>;      <span class="comment">/* head node */</span>
<a name="l00298"></a><a class="code" href="structsplit__str__s.html#o1">00298</a>   <a class="code" href="structsplit__str__node__s.html">split_str_node_t</a>  *<a class="code" href="structsplit__str__s.html#o1">tail</a>;      <span class="comment">/* tail node */</span>
<a name="l00299"></a><a class="code" href="structsplit__str__s.html#o2">00299</a>   <span class="keywordtype">int</span>               <a class="code" href="structsplit__str__s.html#o2">elements</a>;   <span class="comment">/* number of nodes in list */</span>
00300 } <a class="code" href="structsplit__str__s.html">split_str_t</a>;
00301 
00302 
00303 <span class="comment">/* peer_info_t</span>
00304 <span class="comment">*</span>
00305 <span class="comment">*  Used to store information about the connected peer.  Only one of</span>
00306 <span class="comment">*  SMTP protocol specific three strings will be necessarily be</span>
00307 <span class="comment">*  populated in the following order of precedence: FROM, EHLO, HELO.</span>
00308 <span class="comment">*</span>
00309 <span class="comment">*  The ip_ver string will contain 'in-addr' if the connecting peer</span>
00310 <span class="comment">*  is using IPv4, or 'ip6' if the connect</span>
00311 <span class="comment">*</span>
00312 <span class="comment">*  Various political and technical pressures have recently led to</span>
00313 <span class="comment">*  the deprecation of the IP6.INT name space in favour of IP6.ARPA.</span>
00314 <span class="comment">*  This makes IPv6 PTR data management difficult, since interim</span>
00315 <span class="comment">*  clients will search IP6.INT while standard clients will search</span>
00316 <span class="comment">*  IP6.ARPA. We present a simple method based on DNAME RR's</span>
00317 <span class="comment">*  (see [RFC2672]) and ISC BIND9 whereby zone information can be</span>
00318 <span class="comment">*  managed in a single location and then made visible in two</span>
00319 <span class="comment">*  namespaces.  (http://www.isc.org/tn/isc-tn-2002-1.html)</span>
00320 <span class="comment">*</span>
00321 <span class="comment">*  RFC 937 (POP) states: The maximum length of a command line is 512</span>
00322 <span class="comment">*  characters (including the command word and the CRLF).</span>
00323 <span class="comment">*  POLICY_MATCH = SPF_TRUE</span>
00324 <span class="comment">*</span>
00325 <span class="comment">*  Note: from can be removed and just work on local_part@cur_dom</span>
00326 <span class="comment">*</span>
00327 <span class="comment">*/</span>
<a name="l00328"></a><a class="code" href="structpeer__info__s.html">00328</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structpeer__info__s.html">peer_info_s</a>
00329 {
<a name="l00330"></a><a class="code" href="structpeer__info__s.html#o0">00330</a>   <a class="code" href="spf_8h.html#a35">SPF_BOOL</a> <a class="code" href="structpeer__info__s.html#o0">ALL</a>;                           <span class="comment">/* Was 'all' mechanism parsed */</span>
00331 
<a name="l00332"></a><a class="code" href="structpeer__info__s.html#o1">00332</a>   <a class="code" href="spf_8h.html#a36">SPF_RESULT</a> <a class="code" href="structpeer__info__s.html#o1">RES</a>;                         <span class="comment">/* SPF error codes for result */</span>
<a name="l00333"></a><a class="code" href="structpeer__info__s.html#o2">00333</a>   <a class="code" href="spf_8h.html#a36">SPF_RESULT</a> <a class="code" href="structpeer__info__s.html#o2">RES_P</a>;                       <span class="comment">/* prefix behaviour */</span>
00334 
<a name="l00335"></a><a class="code" href="structpeer__info__s.html#o3">00335</a>   <a class="code" href="spf_8h.html#a35">SPF_BOOL</a> <a class="code" href="structpeer__info__s.html#o3">use_trust</a>;                     <span class="comment">/* T / F trustedfwder */</span>
<a name="l00336"></a><a class="code" href="structpeer__info__s.html#o4">00336</a>   <a class="code" href="spf_8h.html#a35">SPF_BOOL</a> <a class="code" href="structpeer__info__s.html#o4">use_guess</a>;                     <span class="comment">/* T / F best guess */</span>
00337 
<a name="l00338"></a><a class="code" href="structpeer__info__s.html#o5">00338</a>   u_int8_t <a class="code" href="structpeer__info__s.html#o5">spf_ver</a>;                       <span class="comment">/* version of SPF */</span>
00339 
<a name="l00340"></a><a class="code" href="structpeer__info__s.html#o6">00340</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o6">p</a>;                                <span class="comment">/* prefix from all mechanism */</span>
<a name="l00341"></a><a class="code" href="structpeer__info__s.html#o7">00341</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o7">rs</a>;                               <span class="comment">/* ptr str result of SPF query */</span>
<a name="l00342"></a><a class="code" href="structpeer__info__s.html#o8">00342</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o8">helo</a>;                             <span class="comment">/* HELO string */</span>
<a name="l00343"></a><a class="code" href="structpeer__info__s.html#o9">00343</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o9">ehlo</a>;                             <span class="comment">/* pointer to HELO string */</span>
<a name="l00344"></a><a class="code" href="structpeer__info__s.html#o10">00344</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o10">from</a>;                             <span class="comment">/* FROM string */</span>
<a name="l00345"></a><a class="code" href="structpeer__info__s.html#o11">00345</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o11">explain</a>;                          <span class="comment">/* Result of an explain query */</span>
<a name="l00346"></a><a class="code" href="structpeer__info__s.html#o12">00346</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o12">guess</a>;                            <span class="comment">/* Query if result is TF fails */</span>
<a name="l00347"></a><a class="code" href="structpeer__info__s.html#o13">00347</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o13">trusted</a>;                          <span class="comment">/* Query if primary result is none */</span>
<a name="l00348"></a><a class="code" href="structpeer__info__s.html#o14">00348</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o14">ptr_mhost</a>;                        <span class="comment">/* validate against during ptr mech */</span>
<a name="l00349"></a><a class="code" href="structpeer__info__s.html#o15">00349</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o15">current_domain</a>;                   <span class="comment">/* @domain of the current query */</span>
<a name="l00350"></a><a class="code" href="structpeer__info__s.html#o16">00350</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o16">mta_hname</a>;                        <span class="comment">/* ptr to MTA hname eg: mail.foo.org */</span>
<a name="l00351"></a><a class="code" href="structpeer__info__s.html#o17">00351</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o17">r_ip</a>;                             <span class="comment">/* pointer to remote ip from MTA */</span>
<a name="l00352"></a><a class="code" href="structpeer__info__s.html#o18">00352</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o18">r_vhname</a>;                         <span class="comment">/* validated hostname of remotehost */</span>
<a name="l00353"></a><a class="code" href="structpeer__info__s.html#o19">00353</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o19">cur_eaddr</a>;                        <span class="comment">/* current email address */</span>
00354 
<a name="l00355"></a><a class="code" href="structpeer__info__s.html#o20">00355</a>   <span class="keywordtype">char</span> <a class="code" href="structpeer__info__s.html#o20">ip_ver</a>[<a class="code" href="spf_8h.html#a12">SPF_MAX_IP_VER</a>];            <span class="comment">/* IP Protocol Version */</span>
<a name="l00356"></a><a class="code" href="structpeer__info__s.html#o21">00356</a>   <span class="keywordtype">char</span> <a class="code" href="structpeer__info__s.html#o21">local_part</a>[<a class="code" href="spf_8h.html#a7">SPF_MAX_LOCAL_PART</a>];    <span class="comment">/* local part of address (user) */</span>
<a name="l00357"></a><a class="code" href="structpeer__info__s.html#o22">00357</a>   <span class="keywordtype">char</span> <a class="code" href="structpeer__info__s.html#o22">utc_time</a>[<a class="code" href="spf_8h.html#a10">SPF_MAX_UTC_TIME</a>];        <span class="comment">/* The number of seconds since the Epoch */</span>
<a name="l00358"></a><a class="code" href="structpeer__info__s.html#o23">00358</a>   <span class="keywordtype">char</span> <a class="code" href="structpeer__info__s.html#o23">last_m</a>[<a class="code" href="spf_8h.html#a20">SPF_MAX_MECHANISM</a>];         <span class="comment">/* last mechanism parsed */</span>
<a name="l00359"></a><a class="code" href="structpeer__info__s.html#o24">00359</a>   <span class="keywordtype">char</span> <a class="code" href="structpeer__info__s.html#o24">error</a>[<a class="code" href="spf_8h.html#a16">SPF_MAX_ERROR</a>];              <span class="comment">/* error (if any) that caused failure */</span>
00360 
<a name="l00361"></a><a class="code" href="structpeer__info__s.html#o25">00361</a>   <a class="code" href="structspf__result__t.html">spf_result_t</a> *<a class="code" href="structpeer__info__s.html#o25">spf_result</a>;               <span class="comment">/* table of str, see spf_result_t */</span>
00362 
<a name="l00363"></a><a class="code" href="structpeer__info__s.html#o26">00363</a>   <span class="keyword">struct </span>in_addr addr;                    <span class="comment">/* IP of the remote host (peer) */</span>
00364 
00365   <span class="comment">/*</span>
00366 <span class="comment">  *  Vars below here are specific to recursion through layers of SPF queries</span>
00367 <span class="comment">  *  stemming from 'include' and 'redirect' use.  In addition there is a</span>
00368 <span class="comment">  *  also a buffer for CNAME records.</span>
00369 <span class="comment"> */</span>
00370 
<a name="l00371"></a><a class="code" href="structpeer__info__s.html#o27">00371</a>   uint8_t <a class="code" href="structpeer__info__s.html#o27">spf_rlevel</a>;                     <span class="comment">/* recursion level */</span>
00372 
<a name="l00373"></a><a class="code" href="structpeer__info__s.html#o28">00373</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o28">cname_buf</a>;                        <span class="comment">/* buf for CNAME records */</span>
<a name="l00374"></a><a class="code" href="structpeer__info__s.html#o29">00374</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o29">include_buf</a>;                      <span class="comment">/* buf for 'include' instances */</span>
<a name="l00375"></a><a class="code" href="structpeer__info__s.html#o30">00375</a>   <span class="keywordtype">char</span> *<a class="code" href="structpeer__info__s.html#o30">redirect_buf</a>;                     <span class="comment">/* buf for 'redirect' instances */</span>
00376 
00377 } <a class="code" href="structpeer__info__s.html">peer_info_t</a>;
00378 
00379 <span class="keyword">extern</span> <a class="code" href="structspf__config__s.html">spf_config_t</a> <a class="code" href="main_8c.html#a0">confg</a>;
00380 <span class="keyword">extern</span> u_int8_t <a class="code" href="spf_8h.html#a48">spf_rlevel</a>;
00381 
00382 <span class="comment">/*  Main library functions (main.c) */</span>
00383 <span class="keyword">extern</span> <a class="code" href="structpeer__info__s.html">peer_info_t</a>  *<a class="code" href="spf_8h.html#a77">SPF_init</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *,
00384                               <span class="keyword">const</span> <span class="keywordtype">char</span> *, u_int32_t, u_int32_t);
00385 <span class="keyword">extern</span> <a class="code" href="structpeer__info__s.html">peer_info_t</a>  *<a class="code" href="spf_8h.html#a78">SPF_close</a>(<a class="code" href="structpeer__info__s.html">peer_info_t</a> *);
00386 <span class="keyword">extern</span> <a class="code" href="spf_8h.html#a36">SPF_RESULT</a>   <a class="code" href="spf_8h.html#a79">SPF_policy_main</a>(<a class="code" href="structpeer__info__s.html">peer_info_t</a> *);
00387 <span class="keyword">extern</span> <a class="code" href="spf_8h.html#a36">SPF_RESULT</a>   <a class="code" href="spf_8h.html#a80">SPF_policy_main_rec</a>(<a class="code" href="structpeer__info__s.html">peer_info_t</a> *);
00388 <span class="keyword">extern</span> <a class="code" href="spf_8h.html#a35">SPF_BOOL</a>     <a class="code" href="spf_8h.html#a81">SPF_parse_policy</a>(<a class="code" href="structpeer__info__s.html">peer_info_t</a> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
00389 <span class="keyword">extern</span> <span class="keywordtype">char</span>         *<a class="code" href="spf_8h.html#a82">SPF_result</a>(<a class="code" href="structpeer__info__s.html">peer_info_t</a> *);
00390 <span class="keyword">extern</span> <a class="code" href="spf_8h.html#a35">SPF_BOOL</a>     <a class="code" href="spf_8h.html#a83">SPF_smtp_from</a>(<a class="code" href="structpeer__info__s.html">peer_info_t</a> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
00391 <span class="keyword">extern</span> <a class="code" href="spf_8h.html#a35">SPF_BOOL</a>     <a class="code" href="spf_8h.html#a84">SPF_smtp_helo</a>(<a class="code" href="structpeer__info__s.html">peer_info_t</a> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
00392 
00393 <span class="comment">/* Functions that alter headers (header.c) */</span>
00394 <span class="keyword">extern</span> <span class="keywordtype">char</span>         *<a class="code" href="spf_8h.html#a85">SPF_build_header</a>(<a class="code" href="structpeer__info__s.html">peer_info_t</a> *);
00395 <span class="keyword">extern</span> <span class="keywordtype">char</span>         *<a class="code" href="spf_8h.html#a86">SPF_get_explain</a>(<a class="code" href="structpeer__info__s.html">peer_info_t</a> *);
00396 
00397 
00398 
00399 __END_DECLS <span class="comment">/* _SPF_H */</span>
00400 
00401 <span class="preprocessor">#endif </span><span class="comment">/* spf.h */</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Thu Sep 16 18:10:47 2004 for libSPF v1.0 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.8 </small></address>
</body>
</html>
