<!-- X-URL: http://www.libspf.org/api_cache.html -->
<!-- Date: Sun, 04 Jul 2004 05:09:17 GMT -->
<!-- Last-Modified: Thu, 24 Jun 2004 03:59:55 GMT -->

<BASE HREF="http://www.libspf.org/api_cache.html">

<html>
<title>libspf.org - The Official ANSI C SPF Library</title>
<head>
 <style text/css>
  <!--
   body
   {
    background: #FFFFFF url(images/bg.gif);
    margin: 10px 0px 10px 0px;
    color: #FFFFFF;
   }

   table.encapsulate
   {
    border: 0px;
   }

   table.main
   {
    border: 0px;
    background: #FFFFFF;
   }

   table.menu
   {
    border: 0px;
    background: #2F628D;
   }

   table.news
   {
    border: 0px;
    background: #2F628D;
   }

   td.menu_header
   {
    width: 125px;
    background: #4C7FAA;
    padding: 3px 3px 3px 3px;
    vertical-align: top;
    font: normal normal bold 12px  sans-serif, arial, verdana;
   }

   td.menu_body
   {
    width: 125px;
    padding: 3px 3px 3px 3px;
    vertical-align: top;
    font: normal normal normal 12px sans-serif, arial, verdana;
   }

   td.main
   {
    width: 545px;
    padding: 5px 5px 5px 5px;
    vertical-align: top;
    font: normal normal normal 12px sans-serif, arial, verdana; 
   }

   td.news_header
   {
    background: #4C7FAA;
    padding: 3px 3px 3px 3px;
    vertical-align: top;
    font: normal normal bold 10px  sans-serif, arial, verdana;
   }

   td.news_body
   {
    padding: 3px 3px 3px 3px;
    vertical-align: top;
    font: normal normal normal 12px sans-serif, arial, verdana;
   }

   A:link
   {
     text-decoration: underline;
     color: #ffffff;
   } 
                   
   A:visited
   {
     text-decoration: underline;
     color: #ffffff;
   }   
                    
   A:active
   {
     text-decoration: underline;
     color: #ffffff;
   }
           
   A:hover
   {
     text-decoration: none;
     color: #ffffff;
   }

  -->
 </style>
</head>
<body>

<!-- File:   index.html -->
<!-- Author: James Couzens <jcouzens@codeshare.ca> -->
<!-- Date:   July 2, 2004 -->
<!-- Info:   API Cache explanation -->

 <table align="center" class="encapsulate" cellspacing="0" cellpadding="0">
  <tr>
   <td colspan="5" style="height: 1px; background-color: #9C9C9C"></td>
  </tr>

  <tr>
   <td style="width: 1px; height: 2px; background-color: #9C9C9C"></td>
   <td colspan="3" style="width: 2px; height: 2px; background-color: #FFFFFF"></td>
   <td style="width: 1px; height: 2px; background-color: #9C9C9C"></td>
  </tr>
  <tr>
   <td style="width: 1px; background-color: #9C9C9C"></td>
   <td style="width: 2px; background-color: #FFFFFF"></td>
   <td>

    <table class="main" cellspacing="1" cellpadding="0">
     <tr>
      <td style="background-color: #E5E5E5">
       <img src="images/top_envelope.gif"><br>
       <img src="images/top_header.png">
      </td>
     </tr>
     <tr>
      <td style="height: 2px; background-color: #22537C"></td>

     </tr>
     <tr>
      <td style="background-color: #22537C">
       <table class="encapsulate" cellspacing="0" cellpadding="5">
        <tr>
         <td style="vertical-align: top">

          <!-- start main menu table -->
          <table class="menu" cellpadding="0" cellspacing="0">
           <tr>
            <td class="menu_header"><img src="images/plus.gif" align="center"> Main</td>
                                       
           </tr>
           <tr><td style="height: 1px; background: #FFFFFF"></td></tr>
           <tr><td style="height: 1px; background: #1C4C74"></td></tr>
           <tr>
            <td class="menu_body">
             <!-- left menu area -->
             &middot; <a href=/index.html target=_self>News</a><br>
             &middot; <a href=/api_index.html target=_self>API / Docs <br>
             &middot; <a href=/files.html target=_self>Download</a><br>
             &middot; <a href=http://forums.6o4.ca/ target=_blank>Forums</a><br>
             &middot; <a href=mailto:jcouzens@6o4.ca>Contact</a><br>
                                       
           </tr>
           <tr><td style="height: 1px; background: #5588B3"></td></tr>
          </table>
          <!-- end main menu table -->
                                     
          <br>

          <!-- start API Navigation table -->
          <table class="menu" cellpadding="0" cellspacing="0">
           <tr>
            <td class="menu_header"><img src="images/plus.gif" align="center"> API Navigation</td>
           </tr>
               
           <tr><td style="height: 1px; background: #FFFFFF"></td></tr>
           <tr><td style="height: 1px; background: #1C4C74"></td></tr>
           <tr>
            <td class=menu_body>
             &middot; <a href=/api_index.html target=_self>API Index</a><br>
             &middot; <a href=/api_main.html target=_self>Public Functions</a><br>
             &middot; <a href=/api_header.html target=_self>Structures</a><br>
             &middot; <a href=/api_cache.html target=_self>DNS cache</a><br>
             &middot; <a href=/api_avl_tree.html target=_self>AVL Tree Demo</a><br>
             &middot; <a href=/api_example.html target=_self>Example Code</a><br>
            </td>
           </tr>
          </table>
          <!-- end API Navigation table -->

         </td>
         <td class="main">

          <!-- start libspf DNS cache explanation -->

          <table class=news cellpadding=0 cellspacing=0 border=0>
            <tr>
              <td class=news_header>libspf's DNS caching explained...</td>
            </tr>

            <tr><td style="height: 1px; background: #FFFFFF"></td></tr>
            <tr><td style="height: 1px; background: #1C4C74"></td></tr>
            <tr>
              <td class=news_body>
The DNS cache solution used in libspf is basically just 2 <a href=/api_avl_tree.html target=_self>AVL trees</a>: one tree holds all of the relevant DNS result information, while the other tracks the TTLs of the various results in the cache.  The purpose of the second tree is to provide a fast and accurate means of removing entries whose TTLs have expired, arranged in such a way that the smallest nodes in the tree (i.e. the furthest to the left) have the best chance at having expired, making the expiry check (and subsequent deletion) exceptionally cheap.<br>
<br>
Thanks to the balanced nature of AVL trees, it only takes a handful of comparisons to find a DNS record in the cache.  This is slower than, say, a hash table, but unlike hash tables AVL trees can be sized dynamically at runtime.  A hash table that ignores collisions can run into situations where frequently referenced cache entries fight over a position in the hash table if the table is not sufficiently large.  Hash table sizes are added complication as well, since depending on the hash function used, MTA admins are forced to choose either a prime number or a power of two as a hash table size.<br>
<br>
Of course, AVL is not without its own drawbacks.  Foremost is the complexity of the insertion and deletion algorithms (namely, deletion).  Searches, insertions, and deletions in AVL trees also occur in logarithmic time, while the same operations in hash tables happen in constant time (perhaps not if the table uses chaining of some sort as a means of collision resolution, but close enough).&nbsp;&nbsp;AVL trees also require an extra 8 bytes (on a 32 bit arch) per node for left and right child pointers, but it is conjecture as to whether or not this is a disadvantage since AVL trees do not need a large contiguous data structure in memory (while a hash table does).  Both (collision-resolving) hash and AVL implementations would suffer from constant growth if they did not enforce TTL expiry using some method of quickly determining expired entries as described above.<br>
<br>
Overall, it was decided that the AVL implementation was best suited for the job due to its size flexibility and, despite having an inferior time complexity when compared to hash, the implementation is still profoundly faster than querying a DNS server.  The size flexibility means that libspf could be placed into any situation with no DNS cache configuration whatsoeverand still perform very well; whereas with hash, determining the optimal tablesize would require testing and some knowledge of how hash tables work.<br>
<br>
              </td>
            </tr>
            <tr><td style="height: 1px; background: #5588B3"></td></tr>
          </table>

         <!-- end libspf DNS cache explanation --> 

         </td>

        </tr>
       </table>
      </td>
     </tr>
     <tr><td style="height: 2px; background-color: #22537C"></td></tr>
     <tr><td style="height: 10px; background-color: #4C7FAA"></td></tr>
     <tr><td style="height: 20px; background-color: #E5E5E5"></td></tr>
    </table>
   </td>

   <td style="width: 2px; background-color: #FFFFFF"></td>
   <td style="width: 1px; background-color: #9C9C9C"></td>
  </tr>
  <tr>
   <td style="width: 1px; height: 2px; background-color: #9C9C9C"></td>
   <td colspan="3" style="width: 2px; height: 2px; background-color: #FFFFFF"></td>
   <td style="width: 1px; height: 2px; background-color: #9C9C9C"></td>
  </tr>
  <tr>

   <td colspan="5" style="height: 1px; background-color: #9C9C9C"></td>
  </tr>
 </table>
<br>
<font face="verdana, sans-serif, arial" size=1 color=#4C7FAA><center>site design by Travis Anderson</center>
</font>
</body>
</html>
